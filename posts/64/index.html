<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="develop," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="软件架构的终极目标是，用最小的人力成本来满足构建和维护系统的需求。 编程范式 结构化编程 goto 有害 功能性降解拆分 结构化编程对程序控制权的直接转移进行了限制和规范   面向对象编程 限制函数指针的使用 封装，继承，多态 面向对象编程对程序控制权的间接转移进行了限制和规范   函数式编程 没有赋值语句 函数式编程对程序中的赋值进行了限制和规范">
<meta name="keywords" content="develop">
<meta property="og:type" content="article">
<meta property="og:title" content="架构整洁之道笔记">
<meta property="og:url" content="https://mgxian.dev/posts/64/index.html">
<meta property="og:site_name" content="mgxian&#39;s blog">
<meta property="og:description" content="软件架构的终极目标是，用最小的人力成本来满足构建和维护系统的需求。 编程范式 结构化编程 goto 有害 功能性降解拆分 结构化编程对程序控制权的直接转移进行了限制和规范   面向对象编程 限制函数指针的使用 封装，继承，多态 面向对象编程对程序控制权的间接转移进行了限制和规范   函数式编程 没有赋值语句 函数式编程对程序中的赋值进行了限制和规范">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/9f1eb91b-871f-4d36-a4b3-e8d8a922774c-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/d0d0ade4-b17f-4cc3-91f7-f021c7e9cd62-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/750cb35e-a9bb-419b-900a-d4a53fd945ce-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/64be66be-1a4a-4713-8c2b-14b77c676c66-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/4a561a0e-5cc8-4d34-8eee-4163545e39aa-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/351aeeff-0bef-490d-bf1f-f1ade9a951df-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/2ebfd785-a8c6-4e61-ac47-e735e2bdc4c8-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/f432adcd-7284-47c8-94d6-cc9b852ed347-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/df0f5227-a7e3-4800-850e-8814410458e6-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/1f4d4914-b37b-4a8d-8f06-1fe691b1537c-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/a68bd7a5-b37d-47a6-9833-92ca43ee2405-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/6a321fa8-2113-4d1e-87ed-f790ee7019cf-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/d8b94cff-e092-46b9-bb96-29504280659c-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/e941b602-3691-4325-9787-952e09c2709b-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/98878366-9148-46ad-b1c4-2dd49fc7db7b-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/29746293-0ff7-4f85-850a-5592c32bf318-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/b3411452-c91e-4016-a385-f9c2b58e9f95-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/6e474703-e74f-4b7c-a49d-17775140a10a-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/617aea50-ffee-4f04-b5eb-e9bb324b61e6-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/6e96a646-4a41-4770-8dac-5885bc0ce190-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/82564c73-32bc-40ce-beb1-02a4fc8129a2-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/4f60d33d-5f79-43f1-be2c-88c8a944989d-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/d0870a66-7988-42e5-bc55-d56bed74f16d-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/6883cd36-fed4-4a7d-a85e-f8713ed9a624-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/e28a4cd9-6af1-410a-896c-73b3446b7b78-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/4f16b61e-1a10-40ca-b78d-87562851cde2-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/5d61e1cd-4258-4d06-b900-fe4ab052979b-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/dfce1ec4-0198-4b83-b645-bc6cf0da59cd-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/4ec97675-c6fc-4ccb-89d3-62d95c213c02-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/27016a1d-3b02-4bb1-89da-51218b76d775-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/8dc199e0-7b95-4394-a432-570da143dc3f-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/2d71ae8c-a6e1-463d-b261-76c82c49da2b-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/d5b78f08-d3ee-458d-9d8f-00a027fa3104-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/d92ffb63-b980-4077-bcf8-9c097896d02b-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/1bbea9a2-0b9d-47df-b809-e8dc2e98611f-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/3864cdd4-b1c1-4f9a-ba97-6ccc847aa0cf-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/91da9c12-de68-4ccf-8761-3e4a2d93a226-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/253e3f65-c58d-483e-909f-b136ce825aae-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/4087ac29-6bfb-4f26-b2eb-3d55f91e12ee-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/22811a26-49f4-4431-bf61-3308d8509c8f-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/dab98f12-1aa6-4882-b517-5302e2765ab2-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/44627815-022f-4740-88c7-6a26f2ac9b3f-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/276b39cf-11d6-4d5e-a719-6c1d580ea262-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/c3194932-4782-42b1-9026-ac9b70420ed7-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/ee10ce2a-9f52-44a1-9fb2-74d7481936b9-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/da3c575f-b315-48d8-a11f-a9f0d72b5dfa-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/5cec86d7-1a88-43f1-b1a1-199f7d81b7d0-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/31818796-c740-4b62-b51e-1c175de70845-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/75d812ab-dd60-4ee7-912e-13b3c2706243-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/4dd9027b-b38a-47c8-9739-7573bb6bc8d3-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/3c1569ae-b3fc-4f76-984c-20dd7f9138c6-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/44714c84-3279-47dc-9694-22f6f04ca85f-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/13babd3f-c17b-41c4-a452-e557aefebcb4-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/e09ce1e1-62dd-4054-a9ee-d4b541f28c1c-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/fc96eae0-935a-49a2-bebc-1cd4b6a74f1a-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/0c079ff1-2a8f-400f-88d5-66c352867046-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/b11da670-aabf-4add-bb7e-158f2ac555bd-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/8759d7b4-62cf-45fc-9804-7f6d19d13267-156946.jpg">
<meta property="og:image" content="https://api2.mubu.com/v3/document_image/f4adf1aa-05b3-4aff-aa80-8415a8c37b8d-156946.jpg">
<meta property="og:updated_time" content="2022-10-06T10:45:14.832Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="架构整洁之道笔记">
<meta name="twitter:description" content="软件架构的终极目标是，用最小的人力成本来满足构建和维护系统的需求。 编程范式 结构化编程 goto 有害 功能性降解拆分 结构化编程对程序控制权的直接转移进行了限制和规范   面向对象编程 限制函数指针的使用 封装，继承，多态 面向对象编程对程序控制权的间接转移进行了限制和规范   函数式编程 没有赋值语句 函数式编程对程序中的赋值进行了限制和规范">
<meta name="twitter:image" content="https://api2.mubu.com/v3/document_image/9f1eb91b-871f-4d36-a4b3-e8d8a922774c-156946.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://mgxian.dev/posts/64/"/>





  <title>架构整洁之道笔记 | mgxian's blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">mgxian's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://mgxian.dev/posts/64/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="mgxian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mgxian's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">架构整洁之道笔记</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-06T13:33:24+08:00">
                2021-04-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/开发/" itemprop="url" rel="index">
                    <span itemprop="name">开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <ul>
<li>软件架构的终极目标是，用最小的人力成本来满足构建和维护系统的需求。</li>
<li>编程范式<ul>
<li>结构化编程<ul>
<li>goto 有害</li>
<li>功能性降解拆分</li>
<li>结构化编程对程序控制权的直接转移进行了限制和规范</li>
</ul>
</li>
<li>面向对象编程<ul>
<li>限制函数指针的使用</li>
<li>封装，继承，多态</li>
<li>面向对象编程对程序控制权的间接转移进行了限制和规范</li>
</ul>
</li>
<li>函数式编程<ul>
<li>没有赋值语句</li>
<li>函数式编程对程序中的赋值进行了限制和规范<a id="more"></a></li>
</ul>
</li>
</ul>
</li>
<li>设计原则<ul>
<li>SOLID<ul>
<li>SRP (Signle Responsibility Principle) 单一职责原则<ul>
<li>任何一个软件模块都应该只对某一类行为者负责</li>
</ul>
</li>
<li>OCP (Open Closed Principle) 开闭原则<ul>
<li>设计良好的计算机软件应该易于扩展，同时抗拒修改</li>
<li>设计原则的终极目标</li>
<li>财务报告示例<ul>
<li>职责划分<img src="https://api2.mubu.com/v3/document_image/9f1eb91b-871f-4d36-a4b3-e8d8a922774c-156946.jpg" alt=""></li>
<li>组件划分 <img src="https://api2.mubu.com/v3/document_image/d0d0ade4-b17f-4cc3-91f7-f021c7e9cd62-156946.jpg" alt=""></li>
<li>组件依赖关系<img src="https://api2.mubu.com/v3/document_image/750cb35e-a9bb-419b-900a-d4a53fd945ce-156946.jpg" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>LSP (Liskov Substitution Principle) 里式替换原则<img src="https://api2.mubu.com/v3/document_image/64be66be-1a4a-4713-8c2b-14b77c676c66-156946.jpg" alt=""><ul>
<li>继承的使用指导</li>
<li>类/接口的不同子类对象/实现应该可以相互替换，而调用方不用做修改</li>
</ul>
</li>
<li>ISP (Interface Segregation Principle) 接口隔离原则<img src="https://api2.mubu.com/v3/document_image/4a561a0e-5cc8-4d34-8eee-4163545e39aa-156946.jpg" alt=""><ul>
<li>客户端不应该依赖它不需要的接口，一个类对另一个类的依赖应该建立在最小的接口上</li>
</ul>
</li>
<li>DIP (Dependency Inversion Principle) 依赖反转原则<ul>
<li>稳定的抽象层<ul>
<li>应在代码中多使用抽象接口，尽量避免使用那些多变的具体实现类</li>
<li>不要在具体实现类上创建衍生类</li>
<li>不要覆盖包含具体实现的函数</li>
<li>应避免在代码中写入任何具体实现相关的名字，或者是其他容易变动的事物的名字</li>
</ul>
</li>
<li>工厂模式<img src="https://api2.mubu.com/v3/document_image/351aeeff-0bef-490d-bf1f-f1ade9a951df-156946.jpg" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>组件构建原则<ul>
<li>组件聚合<ul>
<li>REP 复用/发布等同原则<ul>
<li>软件复用的最小粒度应等同于其发布的最小粒度</li>
<li>组件中的类与模块必须是彼此紧密相关的</li>
<li>组件中包含的类与模块还应该是可以同时发布的</li>
</ul>
</li>
<li>CCP 共同闭包原则<ul>
<li>应该将同时修改，为了相同目的而修改的类放到同一个组件中</li>
</ul>
</li>
<li>CRP 共同复用原则<ul>
<li>不要强迫一个组件的用户依赖他们不需要的东西</li>
</ul>
</li>
<li>三原则张力图<img src="https://api2.mubu.com/v3/document_image/2ebfd785-a8c6-4e61-ac47-e735e2bdc4c8-156946.jpg" alt=""></li>
</ul>
</li>
<li>组件耦合<ul>
<li>无依赖环原则<ul>
<li>组件依赖关系图中不应该出现环</li>
<li>典型的组件结构图<img src="https://api2.mubu.com/v3/document_image/f432adcd-7284-47c8-94d6-cc9b852ed347-156946.jpg" alt=""></li>
<li>打破循环依赖<ul>
<li>存在依赖环的组件图<img src="https://api2.mubu.com/v3/document_image/df0f5227-a7e3-4800-850e-8814410458e6-156946.jpg" alt=""></li>
<li>应用依赖反转原则<img src="https://api2.mubu.com/v3/document_image/1f4d4914-b37b-4a8d-8f06-1fe691b1537c-156946.jpg" alt=""></li>
<li>创建一个新组件<img src="https://api2.mubu.com/v3/document_image/a68bd7a5-b37d-47a6-9833-92ca43ee2405-156946.jpg" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>稳定依赖原则<ul>
<li>依赖关系必须要指向更稳定的方向</li>
<li>稳定性指标<ul>
<li>Fan-in: 入向依赖，组件外部类依赖于组件内部类的数量</li>
<li>Fan-out: 出向依赖，组件内部类依赖于组件外部类的数量</li>
<li>I: 不稳定性 I = Fan-out / ( Fan-out + Fan-in )</li>
</ul>
</li>
<li>稳定依赖原则（ SDP ）的要求是让每个组件的 I 指标都必须大于其所依赖组件的 I 指标。也就是说，组件结构依赖图中各组件的 I 指标必须要按其依赖关系方向递减。</li>
<li>解决违反稳定依赖原则的情况<ul>
<li>违反稳定依赖原则的情况<img src="https://api2.mubu.com/v3/document_image/6a321fa8-2113-4d1e-87ed-f790ee7019cf-156946.jpg" alt=""></li>
<li>使用 DIP 原则解决<img src="https://api2.mubu.com/v3/document_image/d8b94cff-e092-46b9-bb96-29504280659c-156946.jpg" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>稳定抽象原则<ul>
<li>一个组件的抽象化程度应该与其稳定性保持一致</li>
<li>稳定的组件应该是抽象的，不稳定的组件应该包含具体的实现代码，如果一个组件想要成为稳定组件，那么它就应该由接口和抽象类组成，以便将来做扩展</li>
<li>衡量抽象化程度<ul>
<li>Nc: 组件中类的数量</li>
<li>Na: 组件中抽象类和接口的数量</li>
<li>A: 抽象程度 A = Na / Nc</li>
</ul>
</li>
</ul>
</li>
<li>排除区<img src="https://api2.mubu.com/v3/document_image/e941b602-3691-4325-9787-952e09c2709b-156946.jpg" alt=""></li>
<li>离主序列线的距离<ul>
<li>D 指标： 距离D=I A +I - 1 I</li>
<li>对于一个良好的系统设计来说， D 指标的平均值和方差都应该接近于0</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>软件架构<ul>
<li>设计软件架构的目的，就是为了在工作中更好地对这些组件进行研发、部署、运行以及维护</li>
<li>如果想设计一个便于推进各项工作的系统，其策略就是要在设计中尽可能长时间地保留尽可能多的可选项<ul>
<li>软件架构师的目标是创建一种系统形态，该形态会以策略为最基本的元素，并让细节与策略脱离，以允许在具体决策过程中推迟或延迟与细节相关的内容。举例如下：<ul>
<li>开发早期应该无须选择数据库系统，高层策略并不关心底层是什么数据库</li>
<li>开发早期也不应该选定使用的 Web 服务，高层策略不应该知道自己未来以网页形式发布</li>
<li>开发早期也不应该过早的使用 REST 模式，高层策略应该与外部接口无关，同样也不应该过早考虑微服务框架、SOA框架等</li>
<li>开发早期不应该过早地采用依赖注入框架，高层策略不应该操心如何解析系统的依赖关系</li>
</ul>
</li>
<li>一个优秀的软件架构师应该致力于最大化可选数量</li>
</ul>
</li>
<li>解耦<ul>
<li>按层解耦（水平切分）<ul>
<li>UI</li>
<li>业务逻辑</li>
<li>数据库</li>
</ul>
</li>
<li>用例解耦（垂直切分）<ul>
<li>增加订单</li>
<li>删除订单</li>
</ul>
</li>
</ul>
</li>
<li>划分边界<ul>
<li>边界线应该画在那些不相关的事情中问。GUI 与业务逻辑无关，所以两者之间应该有一条边界线。数据库与GUI 无关，这两者之间也应该有一条边界线。数据库又与业务逻辑无关，所以两者之间也应该有一条边界线。</li>
<li>数据库与业务逻辑边界<img src="https://api2.mubu.com/v3/document_image/98878366-9148-46ad-b1c4-2dd49fc7db7b-156946.jpg" alt=""></li>
<li>业务逻辑组件与数据库组件关系<img src="https://api2.mubu.com/v3/document_image/29746293-0ff7-4f85-850a-5592c32bf318-156946.jpg" alt=""><ul>
<li>数据库组件依赖于业务逻辑组件</li>
</ul>
</li>
<li>GUI 与业务逻辑组件的边界线<img src="https://api2.mubu.com/v3/document_image/b3411452-c91e-4016-a385-f9c2b58e9f95-156946.jpg" alt=""><ul>
<li>GUI 依赖业务逻辑组件</li>
</ul>
</li>
<li>插件式架构<img src="https://api2.mubu.com/v3/document_image/6e474703-e74f-4b7c-a49d-17775140a10a-156946.jpg" alt=""><ul>
<li>系统的核心业务逻辑必须和其他组件隔离，保持独立，而这些其他组件要么是可以去掉的， 要么是有多种实现的</li>
</ul>
</li>
</ul>
</li>
<li>跨边界调用<ul>
<li>低层客户端来调用高层服务函数<img src="https://api2.mubu.com/v3/document_image/617aea50-ffee-4f04-b5eb-e9bb324b61e6-156946.jpg" alt=""></li>
<li>高层组件中的客户端需要调用低层组件中的服务<img src="https://api2.mubu.com/v3/document_image/6e96a646-4a41-4770-8dac-5885bc0ce190-156946.jpg" alt=""></li>
</ul>
</li>
<li>策略与层次<ul>
<li>层次（Level)<ul>
<li>一条策略距离系统的输入／输出越远，它所属的层次就越高。而直接管理输入／输出的策略在系统中的层次是最低的。</li>
<li>示例程序<img src="https://api2.mubu.com/v3/document_image/82564c73-32bc-40ce-beb1-02a4fc8129a2-156946.jpg" alt=""><ul>
<li>程序从输入设备读取字符，然后用查表法转换这些字符，并将转换后的字符输出到输出设备</li>
<li>不正确的架构设计<img src="https://api2.mubu.com/v3/document_image/4f60d33d-5f79-43f1-be2c-88c8a944989d-156946.jpg" alt=""><ul>
<li>上面这个程序架构设计的错误在于，它让高层组件中的函数 encrypt() 依赖于低层组件中的函数 readChar() 与 writeChar()</li>
</ul>
</li>
<li>更好的系统架构设计<img src="https://api2.mubu.com/v3/document_image/d0870a66-7988-42e5-bc55-d56bed74f16d-156946.jpg" alt=""><ul>
<li>被虚线框起来的 Encrypt 类及其两个接口 CharReader 和 CharWriter 。所有的依赖关系都指向了边界内部。这一切都说明它是该系统中最高层次的组件。</li>
<li>ConsoleReader 和 ConsoleWriter 都属于具体类。由于它们与输入／输出最近，因此属于低层组件。</li>
</ul>
</li>
</ul>
</li>
<li>低层组件应该成为高层组件的插件<img src="https://api2.mubu.com/v3/document_image/6883cd36-fed4-4a7d-a85e-f8713ed9a624-156946.jpg" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>业务逻辑<ul>
<li>我们可以把应用程序划分为业务逻辑和插件两部分</li>
<li>业务逻辑就是程序中那些真正用于赚钱或省钱的业务逻辑与过程无论这些业务逻辑是在计算机上实现的，还是人工执行的，它们在省钱／赚钱上的作用都是一样的。<ul>
<li>关键业务逻辑：它们是一项业务的关键部分，不管有没有自动化系统来执行这项业务，这一点是不会改变的。</li>
<li>关键业务数据：“关键业务逻辑”通常会需要处理一些数据</li>
</ul>
</li>
<li>业务实体（ Entity ）<ul>
<li>关键业务逻辑和关键业务数据是紧密相关的，所以它们很适合被放在同一个对象中处理。我们将这种对象称为“业务实体（ Entity ）”</li>
<li>业务实体实际上就是计算机系统中的一种对象，这种对象中包含了一系列用于操作关键数据的业务逻辑</li>
<li>业务实体的接口层则是由那些实现关键业务逻辑、操作关键业务数据的函数组成的</li>
<li>借贷业务的实体类 Loan 的 UML 图<img src="https://api2.mubu.com/v3/document_image/e28a4cd9-6af1-410a-896c-73b3446b7b78-156946.jpg" alt=""></li>
<li>业务实体并不一定是以类形式展现，业务实体不一定非要用面向对象编程语言的类来实现。业务实体这个概念只要求我们将关键业务数据和关键业务逻辑绑定在一个独立的软件模块内</li>
</ul>
</li>
<li>用例<ul>
<li>用例所描述的是某种特定应用情景下的业务逻辑，它并非业务实体中所包含的关键业务逻辑。</li>
<li>用例本质上就是关于如何操作一个自动化系统的描述，它定义了用户需要提供的输入数据、用户应该得到的输出信息以及产生输出所应该采取的处理步骤。</li>
<li>用例示范<img src="https://api2.mubu.com/v3/document_image/4f16b61e-1a10-40ca-b78d-87562851cde2-156946.jpg" alt=""></li>
<li>简而言之，用例控制着业务实体之间的交互方式。</li>
<li>用例并不描述系统与用户之间的接口，它只描述该应用在某些特定情景下的业务逻辑，这些业务逻辑所规范的是用户与业务实体之间的交互方式，它与数据流入／流出系统的方式无关。</li>
<li>用例依赖于业务实体，而业务实体并不依赖于用例。</li>
</ul>
</li>
</ul>
</li>
<li>尖叫的软件架构<ul>
<li>一个系统的架构应该着重于展示系统本身的设计，而并非该系统所使用的框架。<ul>
<li>如果我们要构建的是一个医疗系统，新来的程序员第一次看到其源码和目录时就应该知道这是一个医疗系统。</li>
<li>新来的程序员应该先了解该系统的用例，而非系统的交付方式。</li>
</ul>
</li>
<li>一个良好的架构设计应该围绕着用例来展开， 这样的架构设计可以在脱离框架、工具以及使用环境的情况下完整地描述用例。</li>
<li>良好的架构设计应该尽可能地允许用户推迟和延后决定采用什么框架、数据库、Web 服务以及其他与环境相关的工具。框架应该是一个可选项， 良好的架构设计应该允许用户在项目后期再决定是否采用 Rails 、Spring 、Hibernate 、Tomcat 、MySQL 这些工具。同时，良好的架构设计还应该让我们很容易改变这些决定。总之，良好的架构设计应该只关注用例，并能将它们与其他的周边因素隔离。</li>
<li>Web 只是一种交付手段–一种 IO 设备一一这就是它在应用程序的架构设计中的角色。换句话说，应用程序采用 Web 方式来交付只是一个实现细节，这不应该主导整个项目的结构设计。事实上， 关于一个应用程序是否应该以 Web 形式来交付这件事，它本身就应该是一个被推迟和延后的决策。一个系统应该尽量保持它与交付方式之间的无关性。在不更改基础架构设计的情况下，我们应该可以将一个应用程序交付成命令行程序、Web 程序、富客户端程序、Web 服务程序等任何一种形式的程序。</li>
<li>框架是工具而不是生活信条，我们需要仔细考虑如何能保持对系统用例的关注，避免让框架主导我们的架构设计。</li>
<li>我们测试的应该只是一个简单的业务实体对象，没有任何与框架、数据库相关的依赖关系。总而言之，我们应该通过用例对象来调度业务实体对象，确保所有的测试都不需要依赖框架。</li>
</ul>
</li>
<li>整洁架构<ul>
<li>架构图<img src="https://api2.mubu.com/v3/document_image/5d61e1cd-4258-4d06-b900-fe4ab052979b-156946.jpg" alt=""><ul>
<li>独立于框架：这些系统的架构并不依赖某个功能丰富的框架之中的某个函数。框架可以被当成工具来使用，但不需要让系统来适应框架。</li>
<li>可被测试： 这些系统的业务逻辑可以脱离 UI 、数据库、Web 服务以及其他的外部元素来进行测试。</li>
<li>独立于 UI：这些系统的 UI 变更起来很容易，不需要修改其他的系统部分。例如，我们可以在不修改业务逻辑的前提下将一个系统的 UI 由 Web 界面替换成命令行界面。</li>
<li>独立于数据库：我们可以轻易将这些系统使用的 Oracle 、SQL Server 替换成 Mongo 、BigTable 、CouchDB 之类的数据库。因为业务逻辑与数据库之间已经完成了解耦。</li>
<li>独立于任何外部机构：这些系统的业务逻辑并不需要知道任何其他外部接口的存在。</li>
</ul>
</li>
<li>依赖关系规则<ul>
<li>源码中的依赖关系必须只指向同心圆的内层， 即由低层机制指向高层策略。换句话说， 就是任何属于内层圆中的代码都不应该牵涉外层圆中的代码，尤其是内层圆中的代码不应该引用外层圆中代码所声明的名字，包括函数、类、变量以及一切其他有命名的软件实体。外层圆中使用的数据格式也不应该被内层圆中的代码所使用，尤其是当数据格式是由外层圆的框架所生成时。总之，我们不应该让外层圆中发生的任何变更影响到内层圆的代码。</li>
<li>业务实体<ul>
<li>业务实体这一层中封装的是整个系统的关键业务逻辑， 一个业务实体既可以是一个带有方法的对象，也可以是一组数据结构和函数的集合。无论如何，只要它能被系统中的其他不同应用复用就可以。</li>
</ul>
</li>
<li>用例<ul>
<li>软件的用例层中通常包含的是特定应用场景下的业务逻辑，这里面封装并实现了整个系统的所有用例。这些用例引导了数据在业务实体之间的流入／流出，并指挥着业务实体利用其中的关键业务逻辑来实现用例的设计目标。</li>
</ul>
</li>
<li>接口适配器<ul>
<li>软件的接口适配器层中通常是一组数据转换器，它们负责将数据从对用例和业务实体而言最方便操作的格式，转化成外部系统（譬如数据库以及 Web ）最方便操作的格式。</li>
<li>例如，这一层中应该包含整个 GUI MVC 框架。展示器、视图、控制器都应该属于接口适配器层。而模型部分则应该由控制器传递给用例，再由用例传回展示器和视图。</li>
<li>这一层的代码也会负责将来自外部服务的数据转换成系统内用例与业务实体所需的格式。</li>
</ul>
</li>
<li>框架与驱动程序<ul>
<li>最外层的模型层一般是由工具、数据库、Web 框架等组成的。在这一层中，我们通常只需要编写一些与内层沟通的黏合性代码。</li>
<li>框架与驱动程序层中包含了所有的实现细节。Web 是一个实现细节，数据库也是一个实现细节。</li>
</ul>
</li>
<li>不只四层<ul>
<li>同心圆只是为了说明架构的结构，真正的架构很可能会超过四层。并没有某个规则约定一个系统的架构有且只能有四层。</li>
<li>层次越往内，其抽象和策略的层次越高， 同时软件的抽象程度就越高，其包含的高层策略就越多。最内层的圆中包含的是最通用、最高层的策略，最外层的圆包含的是最具体的实现细节。</li>
</ul>
</li>
<li>跨越边界调用<ul>
<li>依赖反转原则</li>
</ul>
</li>
<li>跨越边界的数据<ul>
<li>跨边界传输的对象应该有一个独立、简单的数据结构。总之，不要投机取巧地直接传递业务实体或数据库记录对象。同时，这些传递的数据结构中也不应该存在违反依赖规则的依赖关系。</li>
<li>当我们进行跨边界传输时， 一定要采用内层最方便使用的形式。</li>
</ul>
</li>
</ul>
</li>
<li>应用场景示例<ul>
<li>架构设计图<img src="https://api2.mubu.com/v3/document_image/dfce1ec4-0198-4b83-b645-bc6cf0da59cd-156946.jpg" alt=""></li>
<li>架构描述<img src="https://api2.mubu.com/v3/document_image/4ec97675-c6fc-4ccb-89d3-62d95c213c02-156946.jpg" alt=""><img src="https://api2.mubu.com/v3/document_image/27016a1d-3b02-4bb1-89da-51218b76d775-156946.jpg" alt=""></li>
<li>所有跨边界的依赖线都是指向内的，这很好地遵守了架构的依赖关系规则。</li>
</ul>
</li>
</ul>
</li>
<li>展示器和谦卑对象<ul>
<li>谦卑对象模式<ul>
<li>谦卑对象模式最初的设计目的是帮助单元测试的编写者区分容易测试的行为与难以测试的行为，并将它们隔离。其设计思路非常简单，就是将这两类行为拆分成两组模块或类。其中一组模块被称为谦卑（Humble）组，包含了系统中所有难以测试的行为，而这些行为已经被简化到不能再简化了。另一组模块则包含了所有不属于谦卑对象的行为。</li>
<li>例如，GUI 通常是很难进行单元测试的，因为让计算机自行检视屏幕内容，并检查指定元素是否出现是非常难的事情。然而，GUI 中的大部分行为实际上是很容易被测试的。这时候，我们就可以利用谦卑对象模式将 GUI 的这两种行为拆分成展示器与视图两部分。</li>
</ul>
</li>
<li>展示器与视图<ul>
<li>视图部分属于难以测试的谦卑对象。这种对象的代码通常应该越简单越好，它只应负责将数据填充到 GUI 上，而不应该对数据进行任何处理。</li>
<li>展示器则是可测试的对象。展示器的工作是负责从应用程序中接收数据，然后按视图的需要将这些数据格式化，以便视图将其呈现在屏幕上。</li>
<li>例子<ul>
<li>如果应用程序需要在屏幕上展示一个日期，那么它传递给展示器的应该是一个 Date 对象。然后展示器会将该对象格式化成所需的字符串形式，并将其填充到视图模型中。</li>
<li>如果应用程序需要在屏幕上展示金额，那么它应该将 Currency 对象传递给展示器。展示器随后会将这个对象按所需的小数位数进行格式化，并加上对应的货币标识符，形成一个字符串存放在视图模型中。如果需要将负数金额显示成红色，那么该视图模型中就应该有一个简单的布尔值被恰当地设置。</li>
</ul>
</li>
</ul>
</li>
<li>应用程序在屏幕上的每个按钮都应该有其对应的名称，这些名称也是由展示器在视图模型中设置的。如果某个按钮需要变灰，展示器就应该将相应的开关变量设置成对应的布尔值。同样，菜单中每个菜单项所显示的值，也应该是一个个由展示器加载到视图模型中的字符串。应用程序在屏幕上显示的每个单选项、多选项以及文本框的名字也都如此，在视图模型中都有相应的字符串和布尔值可供展示器做对应的设置。</li>
<li>总而言之，应用程序所能控制的、要在屏幕上显示的一切东西，都应该在视图模型中以字符串、布尔值或枚举值的形式存在。然后，视图部分除了加载视图模型所需要的值，不应该再做任何其他事情。因此，我们才能说视图是谦卑对象。</li>
<li>测试与架构<ul>
<li>谦卑对象模式就是这方面的一个非常好的例子。我们将系统行为分割成可测试和不可测试两部分的过程常常就也定义了系统的架构边界。</li>
</ul>
</li>
<li>数据库网关<ul>
<li>对于用例交互器（interactor）与数据库中间的组件，我们通常称之为数据库网关。这些数据库网关本身是一个多态接口，包含了应用程序在数据库上所要执行的创建、读取、更新、删除等所有操作。</li>
<li>例子<ul>
<li>如果应用程序需要知道所有昨天登录系统的用户的姓， 那么 UserGateway 接口就应该包含一个 getLastNamesOfUsersWhoLoggedinAfter 方法，接收一个Date 参数，并返回一个包含姓的列表。</li>
</ul>
</li>
<li>Hibernate 这类的 ORM 框架属于数据库层，ORM 其实就是在数据库和数据库网关接口之间构建了另一种谦卑对象的边界。</li>
</ul>
</li>
<li>在每个系统架构的边界处，都有可能发现谦卑对象模式的存在。因为跨边界的通信肯定需要用到某种简单的数据结构，而边界会自然而然地将系统分割成难以测试的部分与容易测试的部分，所以通过在系统的边界处运用谦卑对象模式， 我们可以大幅地提高整个系统的可测试性。</li>
</ul>
</li>
<li>不完全边界<ul>
<li>构建完整的架构边界是一件很耗费成本的事。在这个过程中，需要为系统设计双向的多态边界接口，用于输入和输出的数据结构，以及所有相关的依赖关系管理，以便将系统分割成可独立编译与部署的组件。这里会涉及大量的前期工作，以及大量的后期维护工作。</li>
<li>在很多情况下， 一位优秀的架构师都会认为设计架构边界的成本太高了一一 但为了应对将来可能的需要，通常还是希望预留一个边界。</li>
<li>省掉最后一步<ul>
<li>构建不完全边界的一种方式就是在将系统分割成一系列可以独立编译、独立部署的组件之后，再把它们构建成一个组件。换句话说，在将系统中所有的接口、用于输入／输出的数据格式等每一件事都设置好之后，仍选择将它们统一编译和部署为一个组件。这省去了多组件管理这部分的工作，这就等于省去了版本号管理和发布管理方面的工作。</li>
</ul>
</li>
<li>单向边界<ul>
<li>在设计一套完整的系统架构边界时，往往需要用反向接口来维护边界两侧组件的隔离性。而且， 维护这种双向的隔离性，通常不会是一次性的工作，它需要我们持续地长期投入资源维护下去。</li>
<li>示例<img src="https://api2.mubu.com/v3/document_image/8dc199e0-7b95-4394-a432-570da143dc3f-156946.jpg" alt=""><ul>
<li>你会看到一个临时占位的，将来可被替换成完整架构边界的更简单的结构。这个结构采用了传统的策略模式（strategy pattern）。如你所见，其 Client 使用的是一个由 Serviceimpl 类实现的 ServiceBoundary 接口。</li>
<li>上述设计为未来构建完整的系统架构边界打下了坚实基础。为了未来将 Client 与 Serviceimpl 隔离，必要的依赖反转己经做完了。</li>
</ul>
</li>
</ul>
</li>
<li>门户模式<ul>
<li>一个更简单的架构边界设计： 采用门户模式（facade pattern）</li>
<li>在这种模式下，我们连依赖反转的工作都可以省了</li>
<li>示例<img src="https://api2.mubu.com/v3/document_image/2d71ae8c-a6e1-463d-b261-76c82c49da2b-156946.jpg" alt=""><ul>
<li>需要注意的是，在该设计中， Client 会传递性地依赖于所有的 Service 类。在静态类型语言中，这就意味着对 Service 类的源码所做的任何修改都会导致 Client 的重新编译。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>层次与边界<ul>
<li>游戏架构设计示例<img src="https://api2.mubu.com/v3/document_image/d5b78f08-d3ee-458d-9d8f-00a027fa3104-156946.jpg" alt=""></li>
<li>修正后的架构设计<img src="https://api2.mubu.com/v3/document_image/d92ffb63-b980-4077-bcf8-9c097896d02b-156946.jpg" alt=""></li>
<li>简化版设计图<img src="https://api2.mubu.com/v3/document_image/1bbea9a2-0b9d-47df-b809-e8dc2e98611f-156946.jpg" alt=""><ul>
<li>说明<img src="https://api2.mubu.com/v3/document_image/3864cdd4-b1c1-4f9a-ba97-6ccc847aa0cf-156946.jpg" alt=""><img src="https://api2.mubu.com/v3/document_image/91da9c12-de68-4ccf-8761-3e4a2d93a226-156946.jpg" alt=""></li>
</ul>
</li>
<li>交汇数据流<img src="https://api2.mubu.com/v3/document_image/253e3f65-c58d-483e-909f-b136ce825aae-156946.jpg" alt=""></li>
<li>数据流的分隔<img src="https://api2.mubu.com/v3/document_image/4087ac29-6bfb-4f26-b2eb-3d55f91e12ee-156946.jpg" alt=""></li>
<li>添加一个微服务的 API<img src="https://api2.mubu.com/v3/document_image/22811a26-49f4-4431-bf61-3308d8509c8f-156946.jpg" alt=""></li>
</ul>
</li>
<li>Main 组件<ul>
<li>在所有的系统中，都至少要有一个组件来负责创建、协调、监督其他组件的运转。我们将其称为Main 组件。</li>
<li>最细节化的部分<ul>
<li>Main 组件是系统中最细节化的部分一一也就是底层的策略，它是整个系统的初始点。在整个系统中，除了操作系统不会再有其他组件依赖于它了。Main 组件的任务是创建所有的工厂类、策略类以及其他的全局设施， 并最终将系统的控制权转交给最高抽象层的代码来处理。</li>
<li>Main 组件中的依赖关系通常应该由依赖注入框架来注入。在该框架将依赖关系注入到 Main 组件之后， Main 组件就应该可以在不依赖于该框架的情况下自行分配这些依赖关系了。</li>
<li>请记住， Main 组件是整个系统中细节信息最多的组件。</li>
</ul>
</li>
</ul>
</li>
<li>服务化<ul>
<li>虽然服务化可能有助于提升系统的可扩展性和可研发性，但服务本身却并不能代表整个系统的架构设计。系统的架构是由系统内部的架构边界， 以及边界之间的依赖关系所定义的，与系统中各组件之间的调用和通信方式无关。</li>
<li>一个服务可能是一个独立组件，以系统架构边界的形式隔开。一个服务也可能由几个组件组成，其中的组件以架构边界的形式互相隔离。</li>
<li>架构设计的任务就是找到高层策略与低层细节之间的架构边界，同时保证这些边界遵守依赖关系规则。所谓的服务本身只是一种比函数调用方式成本稍高的，分割应用程序行为的一种形式，与系统架构无关。</li>
<li>关于服务化能带来好处的错误观点<ul>
<li>服务之间是强隔离的，服务化能解耦合</li>
<li>服务独立开发部署</li>
<li>只要使用了服务，就等于有了一套架构</li>
</ul>
</li>
<li>架构设计示例<ul>
<li>原出租车调度系统<img src="https://api2.mubu.com/v3/document_image/dab98f12-1aa6-4882-b517-5302e2765ab2-156946.jpg" alt=""></li>
<li>添加运送猫咪功能后的重构架构图<img src="https://api2.mubu.com/v3/document_image/44627815-022f-4740-88c7-6a26f2ac9b3f-156946.jpg" alt=""></li>
<li>添加运送猫咪功能后的服务化重构架构图<img src="https://api2.mubu.com/v3/document_image/276b39cf-11d6-4d5e-a719-6c1d580ea262-156946.jpg" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>测试边界<ul>
<li>测试也是一种系统组件</li>
<li>不要依赖于多变的东西。譬如， GUI 往往是多变的，因此通过 GUI 来验证系统的测试一定是脆弱的。因此，我们在系统设计与测试设计时，应该让业务逻辑不通过 GUI 也可以被测试。</li>
<li>测试并不是独立于整个系统之外的，恰恰相反，它们是系统的一个重要组成部分。我们需要精心设计这些测试，才能让它们发挥验证系统稳定性和预防问题复发的作用。没有按系统组成部分来设计的测试代码，往往是非常脆弱且难以维护的。这种测试最后常常会被抛弃，因为它们终究会出问题。</li>
<li>测试专用 API<ul>
<li>设计这样一个系统的方法之一就是专门为验证业务逻辑的测试创建一个 API 。这个 API 应该被授予超级用户权限，允许测试代码可以忽视安全限制，绕过那些成本高昂的资源（例如数据库），强制将系统设置到某种可测试的状态中。总而言之，该 API 应该成为用户界面所用到的交互器与接口适配器的一个超集。</li>
</ul>
</li>
<li>测试组件是可以独立部署的</li>
</ul>
</li>
<li>整洁的嵌入式架构<ul>
<li>固件并不一定是指存储在 ROM 中的代码。固件也并不是依据其存储的位置来定义的， 而是由其代码的依赖关系，及其随着硬件的演进在变更难度上的变化来定义的。</li>
<li>虽然你可能并不是嵌入式系统的开发者，但如果你在代码中嵌入了 SQL 或者是代码中引入了对某个平台的依赖的话，其实就是在写固件代码。譬如， Android 工程师在没有将业务逻辑与 Android API 分离之前，实际上也是在写固件代码。</li>
<li>添加硬件抽象层<img src="https://api2.mubu.com/v3/document_image/c3194932-4782-42b1-9026-ac9b70420ed7-156946.jpg" alt=""></li>
<li>添加操作系统抽象层<img src="https://api2.mubu.com/v3/document_image/ee10ce2a-9f52-44a1-9fb2-74d7481936b9-156946.jpg" alt=""></li>
<li>为产品的长期健康着想而采用一套整洁的嵌入式架构是很有必要的。</li>
</ul>
</li>
</ul>
</li>
<li>实现细节<ul>
<li>一个优秀的架构师是不会让实现细节污染整个系统架构的。</li>
<li>数据库只是实现细节<ul>
<li>数据的组织结构， 数据的模型， 都是系统架构中的重要部分， 但是从磁盘上存储／读取数据的机制和手段却没那么重要。关系型数据库强制我们将数据存储成表格并且以 SQL 访问， 主要是为了后者。总而言之， 数据本身很重要， 但数据库系统仅仅是一个实现细节。</li>
</ul>
</li>
<li>Web 是实现细节<ul>
<li>Web 只是一种 I/O 设备</li>
<li>GUI 只是一个实现细节。而 Web 则是 GUI 的一种，所以也是一个实现细节。作为一名软件架构师，我们需要将这类细节与核心业务逻辑隔离开来。</li>
</ul>
</li>
<li>应用程序框架只是实现细节<ul>
<li>请不要嫁给框架！</li>
<li>我们应该将框架作为架构最外圈的一个实现细节来使用，不要让它们进入内圈。</li>
<li>如果框架要求我们根据它们的基类来创建派生类，就请不要这样做！我们可以创造一些代理类，同时把这些代理类当作业务逻辑的插件来管理。</li>
<li>不要让框架污染我们的核心代码，应该依据依赖关系原则，将它们当作核心代码的插件来管理。</li>
</ul>
</li>
</ul>
</li>
<li>案例分析：视频销售网站<ul>
<li>产品<img src="https://api2.mubu.com/v3/document_image/da3c575f-b315-48d8-a11f-a9f0d72b5dfa-156946.jpg" alt=""></li>
<li>用例分析<img src="https://api2.mubu.com/v3/document_image/5cec86d7-1a88-43f1-b1a1-199f7d81b7d0-156946.jpg" alt=""></li>
<li>组件架构<img src="https://api2.mubu.com/v3/document_image/31818796-c740-4b62-b51e-1c175de70845-156946.jpg" alt=""></li>
</ul>
</li>
<li>拾遗<ul>
<li>例子<ul>
<li>假设正在构建一个在线书店，这个例子的任务是实现一个客户查看订单状态的用例。</li>
</ul>
</li>
<li>按层封装<img src="https://api2.mubu.com/v3/document_image/75d812ab-dd60-4ee7-912e-13b3c2706243-156946.jpg" alt=""><img src="https://api2.mubu.com/v3/document_image/4dd9027b-b38a-47c8-9739-7573bb6bc8d3-156946.jpg" alt=""><img src="https://api2.mubu.com/v3/document_image/3c1569ae-b3fc-4f76-984c-20dd7f9138c6-156946.jpg" alt=""></li>
<li>按功能封装<img src="https://api2.mubu.com/v3/document_image/44714c84-3279-47dc-9694-22f6f04ca85f-156946.jpg" alt=""><img src="https://api2.mubu.com/v3/document_image/13babd3f-c17b-41c4-a452-e557aefebcb4-156946.jpg" alt=""></li>
<li>端口和适配器<img src="https://api2.mubu.com/v3/document_image/e09ce1e1-62dd-4054-a9ee-d4b541f28c1c-156946.jpg" alt=""><img src="https://api2.mubu.com/v3/document_image/fc96eae0-935a-49a2-bebc-1cd4b6a74f1a-156946.jpg" alt=""><img src="https://api2.mubu.com/v3/document_image/0c079ff1-2a8f-400f-88d5-66c352867046-156946.jpg" alt=""></li>
<li>按组件封装<img src="https://api2.mubu.com/v3/document_image/b11da670-aabf-4add-bb7e-158f2ac555bd-156946.jpg" alt=""></li>
<li>组织形式与封装的区别<ul>
<li>如果所有的类都是 public 的，那么其实我们就是在用四种不同的方式描述一个传统的分层架构设计方式。<img src="https://api2.mubu.com/v3/document_image/8759d7b4-62cf-45fc-9804-7f6d19d13267-156946.jpg" alt=""></li>
<li>使用访问修饰符<img src="https://api2.mubu.com/v3/document_image/f4adf1aa-05b3-4aff-aa80-8415a8c37b8d-156946.jpg" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/develop/" rel="tag"># develop</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/63/" rel="next" title="用户故事与敏捷方法">
                <i class="fa fa-chevron-left"></i> 用户故事与敏捷方法
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/60/" rel="prev" title="K8S高可用集群部署">
                K8S高可用集群部署 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="mgxian" />
          <p class="site-author-name" itemprop="name">mgxian</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">77</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">61</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/mgxian" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mgxian</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
